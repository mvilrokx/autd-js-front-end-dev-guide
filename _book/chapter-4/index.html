
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Javascript Modules Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="./" />
    
    
    <link rel="prev" href="../chapter-3/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../chapter-1/">
            
                <a href="../chapter-1/">
            
                    
                    Why This Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../chapter-2/">
            
                <a href="../chapter-2/">
            
                    
                    Environment Setup
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../chapter-2/">
            
                <a href="../chapter-2/#prerequisites-nodejs-and-npm">
            
                    
                    Prerequisites: Node.js and npm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../chapter-2/">
            
                <a href="../chapter-2/#initializing-the-project">
            
                    
                    Initializing the Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../chapter-2/">
            
                <a href="../chapter-2/#babel">
            
                    
                    Babel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../chapter-3/">
            
                <a href="../chapter-3/">
            
                    
                    Start Project
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../chapter-3/">
            
                <a href="../chapter-3/#html-starter-page">
            
                    
                    HTML Starter Page
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../chapter-3/">
            
                <a href="../chapter-3/#our-first-javascript">
            
                    
                    Our First JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../chapter-3/">
            
                <a href="../chapter-3/#es2015-javascript-example">
            
                    
                    ES2015 JavaScript Example
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../chapter-3/">
            
                <a href="../chapter-3/#im-watching">
            
                    
                    I'm Watching!
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    Javascript Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="./">
            
                <a href="./#our-first-module">
            
                    
                    Our first Module
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="./">
            
                <a href="./#module-loaders">
            
                    
                    Module Loaders
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="./">
            
                <a href="./#webpack">
            
                    
                    Webpack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../chapter-5/">
            
                <a href="../chapter-5/">
            
                    
                    Linting
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../chapter-5/">
            
                <a href="../chapter-5/#eslint">
            
                    
                    ESLint
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../chapter-5/">
            
                <a href="../chapter-5/#integrate-eslint-with-webpack">
            
                    
                    Integrate ESLint with Webpack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../chapter-5/">
            
                <a href="../chapter-5/#fine-tuning-our-lint-configuration">
            
                    
                    Fine Tuning Our Lint Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../chapter-5/">
            
                <a href="../chapter-5/#automatically-fix-errors">
            
                    
                    Automatically fix errors
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../chapter-6/">
            
                <a href="../chapter-6/">
            
                    
                    Testing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../chapter-6/">
            
                <a href="../chapter-6/#mocha">
            
                    
                    Mocha
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../chapter-6/">
            
                <a href="../chapter-6/#chai">
            
                    
                    Chai
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../chapter-6/">
            
                <a href="../chapter-6/#setup">
            
                    
                    Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../chapter-6/">
            
                <a href="../chapter-6/#add-tests">
            
                    
                    Add Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../chapter-6/">
            
                <a href="../chapter-6/#test-driven-development">
            
                    
                    Test Driven Development
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Source Control (Coming Soon)
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../chapter-8/">
            
                <a href="../chapter-8/">
            
                    
                    Building for Production
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../chapter-8/">
            
                <a href="../chapter-8/#webpack-config-for-production">
            
                    
                    Webpack Config for Production
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../chapter-8/">
            
                <a href="../chapter-8/#plugins-to-improve-production-building">
            
                    
                    Plugins to improve Production Building
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../chapter-9/">
            
                <a href="../chapter-9/">
            
                    
                    Quick Start
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Javascript Modules</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="modular-javascript">Modular JavaScript</h1>
<p>Modularity has always been a staple of good development; it promotes code reuse and enhances maintainability.  Unfortunately, writing modular JavaScript was not easy, at least not until node.js came along.  In fact, JavaScript did not have a way to write modules built into the language.  (Read that last sentence again, out loud.)  Over time, this lead to developers building their own strategies and tools to create modular JavaScript.  I will spare you the history lesson and the cornucopia of solutions this has lead to (but you should definitely Google it) and just let you know that, <em>finally</em>, ES2015 introduced a native feature in the JavaScript language that supports the creation of modules.  And since we are coding in ES2015 already, this is the only solution we will be using going forward.</p>
<h2 id="our-first-module">Our first Module</h2>
<p>Lets go back to our example <code>app.js</code> and introduce some JavaScript Modules to see how they work.  First we create a new folder called <code>lib</code> in our <code>src</code> folder that will hold all our JavaScript Modules. </p>
<pre><code class="lang-bash">$ <span class="hljs-built_in">cd</span> src
$ mkdir lib
$ <span class="hljs-built_in">cd</span> lib
</code></pre>
<p>In this directory, we create a file called sayHello.js and we move the sayHello function into this new file.  To turn this function into a module, all we need to do is export the function:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> sayHello = (name = <span class="hljs-string">&apos;Mark&apos;</span>) =&gt; <span class="hljs-string">`Hello <span class="hljs-subst">${ name }</span>`</span>

<span class="hljs-keyword">export</span> sayHello
</code></pre>
<p>To use the module in <code>app.js</code> we have to import the module:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { sayHello } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./lib/sayHello&apos;</span>

<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;app&apos;</span>).innerHTML = <span class="hljs-string">`&lt;h1&gt;<span class="hljs-subst">${ sayHello() }</span>&lt;/h1&gt;`</span>
</code></pre>
<p>We can actually simplify this a little bit, a module can namely export multiple objects, but one of those can be set as the default:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> sayHello = (name = <span class="hljs-string">&apos;Mark&apos;</span>) =&gt; <span class="hljs-string">`Hello <span class="hljs-subst">${ name }</span>`</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> sayHello
</code></pre>
<p>When you do this, the import statement does not require curly braces for the default object:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> sayHello <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./lib/sayHello&apos;</span>

<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;app&apos;</span>).innerHTML = <span class="hljs-string">`&lt;h1&gt;<span class="hljs-subst">${ sayHello() }</span>&lt;/h1&gt;`</span>
</code></pre>
<p>Note that you can name your imported object anything you want.  I prefer to call it the same as the function that is being imported, but you don&apos;t have to.  This works just as well:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> welcome <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./lib/sayHello&apos;</span>

<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&apos;app&apos;</span>).innerHTML = <span class="hljs-string">`&lt;h1&gt;<span class="hljs-subst">${ welcome() }</span>&lt;/h1&gt;`</span>
</code></pre>
<p>After saving this, your browser should have already refreshed itself with the new code and you will see that ... it does not work.  You will see an error message in the console of your browser (e.g. DevTools in Chrome) that reads something like this:</p>
<p><code>Uncaught ReferenceError: require is not defined(&#x2026;)</code></p>
<p>If you cannot remember having used <code>require</code> in your code, well, you are right, you didn&apos;t.  This error is coming from our compiled code, not from our source code.  And this is raising an interesting problem: how do I know which line in my source code is responsible for this error in the compiled code?  In other words, how does the source code map to the compiled code?</p>
<h3 id="source-maps">Source Maps</h3>
<p>Of course the JavaScript community has a solution for this issue.  &quot;Source Maps&quot; map your source code to your compiled code so that you can keep writing ES2015 code at development time, run ES5 code (compiled by Babel) in the browser, and still see where in the source code the error comes from (even though the browser never gets to see the actual source code).  This feature is actually built into Babel and can easily be switched on by using the <code>-s</code> or <code>--source-maps</code> flag, so let&apos;s add this to our <code>package.json</code> watch script:</p>
<pre><code class="lang-JSON">    <span class="hljs-string">&quot;watch&quot;</span>: <span class="hljs-string">&quot;babel -w src -d dist -s&quot;</span>
</code></pre>
<p>At this point, you do actually have to stop Babel in the terminal that is &quot;watching&quot; and restart it.  Babel only watches for changes in the JavaScript code, not in the actual Babel configuration.  In order to pick up the fact that you now also want to generate Source Maps, you have to stop and restart watch:</p>
<pre><code class="lang-bash">$ npm run watch
</code></pre>
<p>Now you will see that the error actually comes from our <code>import</code> statement in <code>app.js</code>.  So what is going on here?</p>
<h2 id="module-loaders">Module Loaders</h2>
<p>As we discussed at the beginning of this chapter, before ES2015 there was no support for modules in the JavaScript language.  Instead, several tools had emerged that added this sort of functionality to the language.  Babel can actually transpile to most of those solutions but by default it transpiles to the CommonJS model (also used by Node.js), which is where the <code>require</code> comes from: it transpiles our <code>import</code> statement into the following:</p>
<pre><code class="lang-JavaScript"><span class="hljs-keyword">var</span> _sayHello = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;lib/sayHello&apos;</span>);
</code></pre>
<p>Now, <code>require</code> is a function that is provided by e.g. Node.js, but not by the browser, hence the error <code>require is not defined</code>.  So we are now in the interesting situation where we transpiled <code>import</code>, which is not yet supported by any browser, to <code>require</code>, which is also not supported by any browser.  In fact, none of the Module Loaders are supported by any browser.  There&apos;s actually a good reason for this; think about it, these modules are separate files and <code>require</code> needs to load these files from the File System, but a browser does not have a File System, so how <em>could</em> this work?</p>
<p>The solution to this problem is to &quot;bundle&quot; all the modules into 1 large file so that when the browser loads this 1 file, it has access to all modules.</p>
<blockquote>
<p>Note that these bundlers require quite a bit of setup (explained in the next sections), even for our simple setup.  However, over time, the advantages they provide far outweight these annoyances.  Also, once you have 1 project setup it can serve as a template for any new projects, just clone it, run <code>npm init</code> and you are good to go.</p>
</blockquote>
<h3 id="webpack">Webpack</h3>
<p>There are several Module Bundlers out there but we are going to use <a href="http://webpack.github.io/docs/" target="_blank">WebPack 1.x</a>.  Webpack&apos;s scope is actually much broader than just a JavaScript bundler, it can also bundle CSS and even image files (e.g. png files).  All this functionality makes it very flexible, but also a bit trickier to configure.</p>
<h4 id="installation">Installation</h4>
<p>Webpack is a node package, so installation is simple:</p>
<pre><code class="lang-bash">$ npm install webpack --save-dev
</code></pre>
<p>Rather than running Babel directly, from now on, we are going to run Webpack, which will invoke Babel.  We have to install the Babel plugin for Webpack to make this work.  The plugins are called &quot;loaders&quot; in Webpack lingo, and they are (all together now!) available as node packages:</p>
<pre><code class="lang-bash">$ npm install babel-loader --save-dev
</code></pre>
<h4 id="configuration">Configuration</h4>
<p>Once all this is installed we need to configure Webpack.  This is done using a file called <code>webpack.config.js</code>, so create this at the project root folder and add the following into it:</p>
<pre><code class="lang-JavaScript"><span class="hljs-built_in">module</span>.exports = {
  entry: <span class="hljs-string">&apos;./src/app.js&apos;</span>,
  output: {
    path: <span class="hljs-string">&apos;./dist&apos;</span>,
    filename: <span class="hljs-string">&apos;app.js&apos;</span>,
  },
  devtool: <span class="hljs-string">&apos;inline-source-map&apos;</span>,
  <span class="hljs-built_in">module</span>: {
    loaders: [{
      test: <span class="hljs-regexp">/\.js$/</span>,
      exclude: <span class="hljs-regexp">/node_modules/</span>,
      loader: <span class="hljs-string">&apos;babel-loader&apos;</span>
    }]
  }
}
</code></pre>
<p>Here we configure Web Pack to &apos;start&apos; (<code>entry</code>) from our <code>./src/app.js</code> file.  Web Pack will analyze the dependencies of this file and then the dependencies of those files etc. and &apos;bundle&apos; them in a file called <code>./dist/app.js</code> (<code>output</code>).  We also setup Webpack to create inline source maps (<code>devtool</code>)</p>
<h4 id="build">Build</h4>
<p>Now we just have to add a build script in <code>package.json</code> to use Webpack instead of Babel:</p>
<pre><code class="lang-JSON">    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;webpack&quot;</span>
</code></pre>
<p>As you project grows, the compilation will take a bit longer.  You can make this a more pleasant experience by adding a progress bar and some colors.  If you like that sort of thing, change the build line to:</p>
<pre><code class="lang-JSON">    <span class="hljs-string">&quot;build&quot;</span>: <span class="hljs-string">&quot;webpack --progress --colors&quot;</span>
</code></pre>
<h4 id="watch">Watch</h4>
<p>Webpack has a built-in Watch feature, which you enable with the <code>---watch</code> flag, so let&apos;s change the watch script in <code>package.json</code> to:</p>
<pre><code class="lang-JSON">    <span class="hljs-string">&quot;watch&quot;</span>: <span class="hljs-string">&quot;webpack --progress --colors --watch&quot;</span>
</code></pre>
<h4 id="additional-features">Additional Features</h4>
<p>Webpack comes with a feature called the Webpack Development Server which offers somewhat similar functionality to browser-sync.  Since we are already using browser-sync, we are going to stick to that, but if you are going to do React.js development you should really look into this tool (with <a href="https://webpack.github.io/docs/hot-module-replacement.html" target="_blank">Hot Module Replacement</a>).  You can install it with:</p>
<pre><code class="lang-bash">$ npm install webpack-dev-server --save-dev
</code></pre>
<p>And then, replace watch in <code>package.json</code> with the following line:</p>
<pre><code class="lang-JSON">    <span class="hljs-string">&quot;watch&quot;</span>: <span class="hljs-string">&quot;webpack-dev-server --progress --colors&quot;</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../chapter-3/#im-watching" class="navigation navigation-prev " aria-label="Previous page: I'm Watching!">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="./#our-first-module" class="navigation navigation-next " aria-label="Next page: Our first Module">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Javascript Modules","level":"1.5","depth":1,"next":{"title":"Our first Module","level":"1.5.1","depth":2,"anchor":"#our-first-module","path":"chapter-4/README.md","ref":"chapter-4/README.md#our-first-module","articles":[]},"previous":{"title":"I'm Watching!","level":"1.4.4","depth":2,"anchor":"#im-watching","path":"chapter-3/README.md","ref":"chapter-3/README.md#im-watching","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["livereload"],"pluginsConfig":{"livereload":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"chapter-4/README.md","mtime":"2016-12-14T00:13:00.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2016-12-14T00:19:57.584Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

